<!doctype html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Green Api Demo</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <style>
      body {
        font-family: Arial, sans-serif;
        line-height: 1.6;
        margin: 0;
        padding: 20px;
        background-color: #f4f4f4;
      }
      .container {
        display: grid;
        grid-template-columns: 1fr 1fr;
        grid-gap: 5%;
        max-width: 90%;
      }
      input {
        width: 100%;
        margin-bottom: 5px;
        display: block;
      }
      button {
        width: 100%;
        height: 30px;
        text-align: center;
        margin-bottom: 5px;
        display: block;
      }
      h1 {
        color: #333;
        border-bottom: 2px solid #007bff;
        padding-bottom: 10px;
      }
      p {
        color: #666;
        text-align: justify;
      }
      .json {
        color: #292626;
        background-color: #dadada;
        padding: 10px;
        border-radius: 4px;
        height: 100%;
        font-size: 14px;
        white-space: pre-wrap;
        word-wrap: break-word;
        overflow: auto;
      }
    </style>
    <script>
      $(document).ready(function () {
        window.greenApi = {
          apiUrl: "",
          mediaUrl: "",
          idInstance: "",
          apiTokenInstance:
            "",
          chatId: "",
          message: "I use Green-API to send this message to you!",
          urlFile: "https://i.sstatic.net/GsMl9.jpg",
          fileName: "json.jpg",
          caption: "json",
        };
        $("#apiUrl").val(window.greenApi.apiUrl);
        $("#mediaUrl").val(window.greenApi.mediaUrl);
        $("#idInstance").val(window.greenApi.idInstance);
        $("#apiTokenInstance").val(window.greenApi.apiTokenInstance);
        $("#chatId").val(window.greenApi.chatId);
        $("#message").val(window.greenApi.message);
        $("#urlFile").val(window.greenApi.urlFile);
        $("#fileName").val(window.greenApi.fileName);
        $("#caption").val(window.greenApi.caption);
        $("#apiUrl").on("input", function () {
          window.greenApi.apiUrl = $(this).val();
        });

        $("#mediaUrl").on("input", function () {
          window.greenApi.mediaUrl = $(this).val();
        });

        $("#idInstance").on("input", function () {
          window.greenApi.idInstance = $(this).val();
        });

        $("#apiTokenInstance").on("input", function () {
          window.greenApi.apiTokenInstance = $(this).val();
        });
        $("#chatId").on("input", function () {
          window.greenApi.chatId = $(this).val();
        });
        $("#message").on("input", function () {
          window.greenApi.message = $(this).val();
        });
        $("#urlFile").on("input", function () {
          window.greenApi.urlFile = $(this).val();
        });
        $("#fileName").on("input", function () {
          window.greenApi.fileName = $(this).val();
        });
        $("#caption").on("input", function () {
          window.greenApi.caption = $(this).val();
        });
        function request(url, method, data) {
          var xhr = new XMLHttpRequest();
          xhr.open(method, url, true);
          xhr.setRequestHeader("Content-Type", "application/json");
          xhr.onreadystatechange = function () {
            if (xhr.readyState === 4) {
              if (xhr.status === 200) {
                $("#result").html(
                  JSON.stringify(JSON.parse(xhr.responseText), null, 2),
                );
              } else {
                $("#result").html(xhr.statusText);
              }
            }
          };
          xhr.send(JSON.stringify(data));
        }
        $("#getSettings").on("click", function () {
          request(
            `${window.greenApi.apiUrl}/waInstance${window.greenApi.idInstance}/getSettings/${window.greenApi.apiTokenInstance}`,
            "GET",
            {}
          );
        });
        $("#getStateInstance").on("click", function () {
          request(
            `${window.greenApi.apiUrl}/waInstance${window.greenApi.idInstance}/getStateInstance/${window.greenApi.apiTokenInstance}`,
            "GET",
            {}
          );
        });
        $("#sendMessage").on("click", function () {
          request(
            `${window.greenApi.apiUrl}/waInstance${window.greenApi.idInstance}/sendMessage/${window.greenApi.apiTokenInstance}`,
            "POST",
            {
              chatId: window.greenApi.chatId,
              message: window.greenApi.message,
            }
          );
        });
        $("#sendFileByUrl").on("click", function () {
          request(
            `${window.greenApi.apiUrl}/waInstance${window.greenApi.idInstance}/sendFileByUrl/${window.greenApi.apiTokenInstance}`,
            "POST",
            {
              chatId: window.greenApi.chatId,
              urlFile: window.greenApi.urlFile,
              fileName: window.greenApi.fileName,
              caption: window.greenApi.caption,
            }
          );
        });
      });
    </script>
  </head>
  <body>
    <div class="container">
      <div>
        <h3>Введите данные для API</h3>
        <label for="apiUrl">API URL:</label>
        <input type="text" id="apiUrl" placeholder="Введите API URL" />
        <label for="mediaUrl">Media URL:</label>
        <input type="text" id="mediaUrl" placeholder="Введите Media URL" />
        <label for="idInstance">ID Instance:</label>
        <input type="text" id="idInstance" placeholder="Введите ID Instance" />
        <label for="apiTokenInstance">API Token Instance:</label>
        <input
          type="text"
          id="apiTokenInstance"
          placeholder="Введите API Token Instance"
        />
        <h4>Получение настроек инстанса</h4>
        <button id="getSettings">getSettings</button>
        <button id="getStateInstance">getStateInstance</button>
        <h3>Отправка сообщений</h3>
        <label for="chatId">chatId:</label>
        <input type="text" id="chatId" placeholder="Введите chatId" />
        <label for="message">message:</label>
        <input type="text" id="message" placeholder="Введите message" />
        <label for="urlFile">urlFile:</label>
        <input type="text" id="urlFile" placeholder="Введите urlFile" />
        <label for="fileName">fileName:</label>
        <input type="text" id="fileName" placeholder="Введите fileName" />
        <label for="caption">caption:</label>
        <input type="text" id="caption" placeholder="Введите caption" />
        <button id="sendMessage">sendMessage</button>
        <button id="sendFileByUrl">sendFileByUrl</button>
      </div>
      <div>
        <h3>Ответ:</h3>
        <p id="result" class="json"></p>
      </div>
    </div>
  </body>
</html>
