<!doctype html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Green Api Demo</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <style>
      body {
        font-family: Arial, sans-serif;
        line-height: 1.6;
        margin: 0;
        padding: 20px;
        background-color: #f4f4f4;
      }
      .container {
        max-width: 800px;
        margin: 0 auto;
        background-color: white;
        padding: 30px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }
      h1 {
        color: #333;
        border-bottom: 2px solid #007bff;
        padding-bottom: 10px;
      }
      p {
        color: #666;
        text-align: justify;
      }
      .json {
        color: #292626;
        background-color: #f4f4f4;
        padding: 10px;
        border-radius: 4px;
        font-size: 14px;
        white-space: pre-wrap;
        word-wrap: break-word;
        overflow: auto;
      }
    </style>
    <script>
      $(document).ready(function () {
        window.greenApi = {
          apiUrl: "",
          mediaUrl: "",
          idInstance: "",
          apiTokenInstance: "",
          chatId: "",
          message: "I use Green-API to send this message to you!",
          urlFile: "https://i.sstatic.net/GsMl9.jpg",
          fileName: "json.jpg",
          caption: "json",
        };
        // for default
        $("#apiUrl").val(window.greenApi.apiUrl);
        $("#mediaUrl").val(window.greenApi.mediaUrl);
        $("#idInstance").val(window.greenApi.idInstance);
        $("#apiTokenInstance").val(window.greenApi.apiTokenInstance);
        $("#chatId").val(window.greenApi.chatId);
        $("#message").val(window.greenApi.message);
        $("#urlFile").val(window.greenApi.urlFile);
        $("#fileName").val(window.greenApi.fileName);
        $("#caption").val(window.greenApi.caption);

        // for input
        $("#apiUrl").on("input", function () {
          window.greenApi.apiUrl = $(this).val();
        });

        $("#mediaUrl").on("input", function () {
          window.greenApi.mediaUrl = $(this).val();
        });

        $("#idInstance").on("input", function () {
          window.greenApi.idInstance = $(this).val();
        });

        $("#apiTokenInstance").on("input", function () {
          window.greenApi.apiTokenInstance = $(this).val();
        });
        $("#chatId").on("input", function () {
          window.greenApi.chatId = $(this).val();
        });
        $("#message").on("input", function () {
          window.greenApi.message = $(this).val();
        });
        $("#urlFile").on("input", function () {
          window.greenApi.urlFile = $(this).val();
        });
        $("#fileName").on("input", function () {
          window.greenApi.fileName = $(this).val();
        });
        $("#caption").on("input", function () {
          window.greenApi.caption = $(this).val();
        });
        // for api
        function request(url, method, data, callback) {
          var xhr = new XMLHttpRequest();
          xhr.open(method, url, true);
          xhr.setRequestHeader("Content-Type", "application/json");
          xhr.onreadystatechange = function () {
            if (xhr.readyState === 4) {
              if (xhr.status === 200) {
                callback(xhr.responseText);
              } else {
                callback(xhr.statusText);
              }
            }
          };
          xhr.send(JSON.stringify(data));
        }
        $("#getSettings").on("click", function () {
          request(
            `${window.greenApi.apiUrl}/waInstance${window.greenApi.idInstance}/getSettings/${window.greenApi.apiTokenInstance}`,
            "GET",
            {},
            function (response) {
              $("#getSettingsResult").html(
                JSON.stringify(JSON.parse(response), null, 2),
              );
            },
          );
        });
        $("#getStateInstance").on("click", function () {
          request(
            `${window.greenApi.apiUrl}/waInstance${window.greenApi.idInstance}/getStateInstance/${window.greenApi.apiTokenInstance}`,
            "GET",
            {},
            function (response) {
              $("#getStateInstanceResult").html(
                JSON.stringify(JSON.parse(response), null, 2),
              );
            },
          );
        });
        $("#sendMessage").on("click", function () {
          request(
            `${window.greenApi.apiUrl}/waInstance${window.greenApi.idInstance}/sendMessage/${window.greenApi.apiTokenInstance}`,
            "POST",
            {
              chatId: window.greenApi.chatId,
              message: window.greenApi.message,
            },
            function (response) {
              $("#sendMessageResult").html(
                JSON.stringify(JSON.parse(response), null, 2),
              );
            },
          );
        });
        $("#sendFileByUrl").on("click", function () {
          request(
            `${window.greenApi.apiUrl}/waInstance${window.greenApi.idInstance}/sendFileByUrl/${window.greenApi.apiTokenInstance}`,
            "POST",
            {
              chatId: window.greenApi.chatId,
              urlFile: window.greenApi.urlFile,
              fileName: window.greenApi.fileName,
              caption: window.greenApi.caption,
            },
            function (response) {
              $("#sendFileByUrlResult").html(
                JSON.stringify(JSON.parse(response), null, 2),
              );
            },
          );
        });
      });
    </script>
  </head>
  <body>
    <div class="container">
      <h2>Введите данные для API</h2>
      <div>
        <label for="apiUrl">API URL:</label>
        <input type="text" id="apiUrl" placeholder="Введите API URL" />
      </div>

      <div>
        <label for="mediaUrl">Media URL:</label>
        <input type="text" id="mediaUrl" placeholder="Введите Media URL" />
      </div>

      <div>
        <label for="idInstance">ID Instance:</label>
        <input type="text" id="idInstance" placeholder="Введите ID Instance" />
      </div>

      <div>
        <label for="apiTokenInstance">API Token Instance:</label>
        <input
          type="text"
          id="apiTokenInstance"
          placeholder="Введите API Token Instance"
        />
      </div>
      <h2>Вызов API</h2>
      <h3>Получение настроек инстанса</h3>
      <div>
        <label for="getSettings">getSettings</label>
        <button id="getSettings">Try it</button>
        <p id="getSettingsResult" class="json"></p>
      </div>
      <div>
        <label for="getStateInstance">getStateInstance</label>
        <button id="getStateInstance">Try it</button>
        <p id="getStateInstanceResult" class="json"></p>
      </div>
      <h3>Отправка сообщений</h3>
      <div>
        <label for="chatId">chatId:</label>
        <input type="text" id="chatId" placeholder="Введите chatId" />
        <br />
        <label for="message">message:</label>
        <input type="text" id="message" placeholder="Введите message" />
        <br />
        <label for="urlFile">urlFile:</label>
        <input type="text" id="urlFile" placeholder="Введите urlFile" />
        <br />
        <label for="fileName">fileName:</label>
        <input type="text" id="fileName" placeholder="Введите fileName" />
        <br />
        <label for="caption">caption:</label>
        <input type="text" id="caption" placeholder="Введите caption" />
        <br />
      </div>
      <h4>Отправка текста</h4>
      <div>
        <label for="sendMessage">sendMessage</label>
        <button id="sendMessage">Try it</button>
        <p id="sendMessageResult" class="json"></p>
      </div>
      <h4>Отправка файла</h4>
      <div>
        <label for="sendFileByUrl">sendFileByUrl</label>
        <button id="sendFileByUrl">Try it</button>
        <p id="sendFileByUrlResult" class="json"></p>
      </div>
    </div>
  </body>
</html>
